name: Supercharged Recon Bot

on:
  workflow_dispatch:
    inputs:
      domain:
        description: 'Target Domain'
        required: true
        default: 'tesla.com'

jobs:
  recon-and-attack:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      # 1. Install ALL the Tools
      - name: Install Arsenal
        run: |
          go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
          go install -v github.com/projectdiscovery/naabu/v2/cmd/naabu@latest
          go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
          go install -v github.com/sensepost/gowitness@latest

      # 2. Run the "Kill Chain"
      - name: Run Recon Chain
        run: |
          mkdir -p screenshots

          # A. Find Subdomains
          echo "üîç Finding Subdomains..."
          subfinder -d ${{ inputs.domain }} -silent > subs.txt
          
          # B. Port Scan (Find weird ports like 8080, 8443)
          echo "üö™ Scanning Ports..."
          naabu -list subs.txt -top-ports 100 -silent > open_ports.txt
          
          # C. Check for Live Web Servers
          echo "üì∂ Checking Live Sites..."
          cat open_ports.txt | httpx -silent -title -tech-detect -status-code > live_full.txt
          # Clean list for tools that just need URLs
          cat live_full.txt | awk '{print $1}' > urls.txt

          # D. Vulnerability Scan (The Attack Step)
          echo "‚ò¢Ô∏è Running Nuclei Vulnerability Scan..."
          # We scan for 'critical' and 'high' severity bugs only to keep it fast
          nuclei -l urls.txt -severity critical,high -silent -o vulns.txt

          # E. Visual Recon
          echo "üì∏ Taking Screenshots..."
          if [ -s urls.txt ]; then
            gowitness scan file -f urls.txt --write-db --screenshot-path ./screenshots/
          fi

          # Save counts for Telegram
          echo "SUB_COUNT=$(wc -l < subs.txt || echo 0)" >> $GITHUB_ENV
          echo "LIVE_COUNT=$(wc -l < urls.txt || echo 0)" >> $GITHUB_ENV
          echo "VULN_COUNT=$(wc -l < vulns.txt || echo 0)" >> $GITHUB_ENV

      # 3. Zip Everything
      - name: Zip Results
        run: zip -r report.zip screenshots/ live_full.txt vulns.txt

      # 4. Send Intelligence Report
      - name: Send to Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          document: report.zip
          message: |
            üö® *New Recon Report*
            *Target:* ${{ inputs.domain }}
            
            üìä *Stats:*
            ‚Ä¢ üîç Subdomains: ${{ env.SUB_COUNT }}
            ‚Ä¢ üì∂ Live Sites: ${{ env.LIVE_COUNT }}
            ‚Ä¢ ‚ò¢Ô∏è *CRITICAL VULNS:* ${{ env.VULN_COUNT }}
            
            _Detailed report and screenshots attached._
          format: markdown
